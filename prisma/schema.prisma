// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Provider{
  GOOGLE
  EAP
}

model User {
  id            String    @id   @map("_id") @default(cuid())
  name          String
  email         String
  emailVerified Boolean @default(false)
  image         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
  sessions      Session[]
  accounts      Account[]
  review    Review[] @relation("user_reviews")
  subscribe Subscriber? @relation("sub_news")
  @@unique([email])
}

model Session {
  id        String   @id @map("_id") @default(cuid())
  expiresAt DateTime?
  token     String  
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@unique([token])
}

model Account {
  id                    String    @id @map("_id") @default(cuid())
  provider              Provider
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @default(now())
}

model Image{
  id String @id @map("_id") @default(cuid())
  url String
  tourid String?
  rattached_to_dest Destination? @relation("dest_has_img")
  rattached_to_tour Tour? @relation("has_img",fields: [tourid],references: [id])
}

model Destination{
  id  String @id @map("_id") @default(cuid())
  title String
  description String
  img String @unique
  has_img Image @relation("dest_has_img",fields: [img],references: [id])
  has_tour Tour[] @relation("has_destination")
}

model Review{
  id String @id @map("_id") @default(cuid())
  user String
  tour String
  star Int
  has_review User @relation("user_reviews",fields: [user],references: [id],onDelete: Cascade)
  has_tour Tour @relation("has_rev",fields: [tour],references: [id],onDelete: Cascade)
}

model Tour{
  id String @id @map("_id") @default(cuid())
  title String
  description String?
  price Int
  discount Int?
  rating Int?
  destination String
  has_destination Destination @relation("has_destination",fields: [destination],references: [id],onDelete: NoAction,onUpdate: NoAction)
  has_reviews Review[] @relation("has_rev")
  has_images Image[] @relation("has_img")
  has_functionnality Tours_Functionnality[] @relation("function belongs to tour")
  has_itinerary Tour_Itinerary[] @relation("refers to a tour")
}

model Newsletter{
  id String @id @map("_id") @default(cuid())
  title String
  content String
  createdAt DateTime @default(now())
  sended SendedNews[] @relation("send_news")
}

model Subscriber{
  id String @id @map("_id") @default(cuid())
  sub_date DateTime @default(now())
  user String @unique
  has_user User @relation("sub_news",fields: [user],references: [id],onDelete: Cascade)
  received_news SendedNews[] @relation("received_news")
}

model SendedNews{
  id String @id @map("_id") @default(cuid())
  news String
  subs String
  send_news Newsletter @relation("send_news",fields: [news],references: [id],onDelete: Cascade)
  received_news Subscriber @relation("received_news",fields: [subs],references: [id],onDelete: Cascade)
}

model Tours_Functionnality{
  id String @id @map("_id") @default(cuid())
  tour_id String
  functionnality_id String
  availability Functionnality_availability
  has_tour Tour @relation("function belongs to tour",fields: [tour_id],references: [id],onDelete: Cascade)
  reference_functionnality Functionnality @relation("refers to a functionnality",fields: [functionnality_id],references: [id],onDelete: Cascade)
}

enum Functionnality_availability{
  Limited_free
  Unlimited_free
  Paying
}

model Functionnality{
  id String @id @map("_id") @default(cuid())
  name String
  belongs_to_tour Tours_Functionnality[] @relation("refers to a functionnality")
}

model Itinerary{
  id String @id @map("_id") @default(cuid())
  name String
  linked_to_tour Tour_Itinerary[] @relation("refers to itinerary")
}

model Tour_Itinerary{
  id String @id @map("_id") @default(cuid())
  tour_id String
  itinerary_id String
  day Int?
  night Int?
  hours Int?
  itinerary Itinerary @relation("refers to itinerary",fields: [itinerary_id],references: [id],onDelete: Cascade) 
  tour Tour @relation("refers to a tour",fields: [tour_id],references: [id],onDelete:Cascade)
}